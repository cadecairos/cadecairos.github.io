<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

    <title>Oh noes.</title>

    <meta name="HandheldFriendly" content="True" />
    <meta name="MobileOptimized" content="320" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" type="text/css" href="/assets/highlighter/prettify.css?v=3a098a1af2" />
    <link rel="stylesheet" type="text/css" href="/assets/css/screen.css?v=3a098a1af2" />

    <script type='text/javascript' src="/assets/js/jquery-3.1.1.min.js?v=3a098a1af2"></script>
    <link rel="canonical" href="https://chrisdecairos.ca/oh-noes/">
    <meta name="referrer" content="no-referrer-when-downgrade">
    
    <meta property="og:site_name" content="Chris DeCairos">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Oh noes.">
    <meta property="og:description" content="I somehow managed to break my blog...

Update: Blog online, data missing. I&#x27;m currently working on recovering it.

update: As of 10:15 PM EDT, the blog is back online!
What happened? Well, It all started when I decided it would be a great idea to
update my Ghost installation">
    <meta property="og:url" content="https://chrisdecairos.ca/oh-noes/">
    <meta property="article:published_time" content="2014-06-30T23:51:46.000Z">
    <meta property="article:modified_time" content="2018-08-22T02:24:40.000Z">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Oh noes.">
    <meta name="twitter:description" content="I somehow managed to break my blog...

Update: Blog online, data missing. I&#x27;m currently working on recovering it.

update: As of 10:15 PM EDT, the blog is back online!
What happened? Well, It all started when I decided it would be a great idea to
update my Ghost installation">
    <meta name="twitter:url" content="https://chrisdecairos.ca/oh-noes/">
    <meta name="twitter:label1" content="Written by">
    <meta name="twitter:data1" content="Chris DeCairos">
    <meta name="twitter:site" content="@ChrisDeCairos">
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "Chris DeCairos",
        "url": "https://chrisdecairos.ca/",
        "logo": {
            "@type": "ImageObject",
            "url": "https://chrisdecairos.ca/content/images/2020/12/profile--Small-.jpg"
        }
    },
    "author": {
        "@type": "Person",
        "name": "Chris DeCairos",
        "image": {
            "@type": "ImageObject",
            "url": "//www.gravatar.com/avatar/5410ec660422c8ea12d4a28ef794a23a?s=250&d=mm&r=x",
            "width": 250,
            "height": 250
        },
        "url": "https://chrisdecairos.ca/author/chris/",
        "sameAs": []
    },
    "headline": "Oh noes.",
    "url": "https://chrisdecairos.ca/oh-noes/",
    "datePublished": "2014-06-30T23:51:46.000Z",
    "dateModified": "2018-08-22T02:24:40.000Z",
    "description": "I somehow managed to break my blog...\n\nUpdate: Blog online, data missing. I&#x27;m currently working on recovering it.\n\nupdate: As of 10:15 PM EDT, the blog is back online!\nWhat happened? Well, It all started when I decided it would be a great idea to\nupdate my Ghost installation to 0.4.2. I&#x27;d done an upgrade before without much\ntrouble so I thought everything would be okay. Unfortunately, Ghost wasn&#x27;t on\nboard with my plan.\n\nI started out by checking out the latest version of ghost on my server, whi",
    "mainEntityOfPage": "https://chrisdecairos.ca/oh-noes/"
}
    </script>

    <meta name="generator" content="Ghost 5.62">
    <link rel="alternate" type="application/rss+xml" title="Chris DeCairos" href="https://chrisdecairos.ca/rss/">
    
    <script defer src="https://cdn.jsdelivr.net/ghost/sodo-search@~1.1/umd/sodo-search.min.js" data-key="6155d3cf5dbae2dc7c7242039b" data-styles="https://cdn.jsdelivr.net/ghost/sodo-search@~1.1/umd/main.css" data-sodo-search="https://chrisdecairos.ca/" crossorigin="anonymous"></script>
    
    <link href="https://chrisdecairos.ca/webmentions/receive/" rel="webmention">
    <script defer src="/public/cards.min.js?v=3a098a1af2"></script><style>:root {--ghost-accent-color: #15171A;}</style>
    <link rel="stylesheet" type="text/css" href="/public/cards.min.css?v=3a098a1af2">
</head>
<body class="post-template">

    

<main class="content" role="main">

    <article class="post no-image">

        <header class="post-header">
            <a id="blog-logo" href="https://chrisdecairos.ca">
                    <img src="https://chrisdecairos.ca/content/images/2020/12/profile--Small-.jpg" alt="Blog Logo" />
            </a>
        </header>


        <span class="post-meta"><time datetime="2014-06-30">30 Jun 2014</time> </span>

        <h1 class="post-title">Oh noes.</h1>

        <section class="post-content">
            <!--kg-card-begin: markdown--><p><strong>I somehow managed to break my blog</strong>...</p>
<p><strong>Update: Blog online, data missing. I'm currently working on recovering it.</strong></p>
<h1 id="updateasof1015pmedttheblogisbackonline">update: As of 10:15 PM EDT, the blog is back online!</h1>
<p>What happened? Well, It all started when I decided it would be a great idea to update my Ghost installation to 0.4.2. I'd done an upgrade before without much trouble so I thought everything would be okay. Unfortunately, Ghost wasn't on board with my plan.</p>
<p>I started out by checking out the latest version of ghost on my server, which went smoothly. Next, I ran <code>sudo sh -c &quot;npm install; bower install; grunt; grunt prod&quot;</code> to get all the dependencies and build all the assets. This went off without a hitch. I restarted my Ghost service and verified it was running.</p>
<p>This is where things get strange. My blog's content seemed to be just fine. But when I attempted to log into the admin console, it would reject the username and password for my account. I was a little annoyed, but not too concerned. I figured I could just reset the password. Nope. Upon trying to send a reset email, I was given an error message claiming that the Gmail account I configured for reset emails couldn't be authenticated. Thats when it hit me: The account was a dummy account I created with the sole purpose of sendign me password reset emails. The very same dummy account that I had gotten an email from Google about one week prior stating it was being closed due to TOS violations. -.-</p>
<p>A simple fix really. Just have to update those settings! Since I have a nice new AWS account with a bunch of credit to burn through, I figured I'd hook it up to SES. I logged into my console, and generated the creds to send emails using SES. I plugged them in, rebooted the service, fired up the forgotten password page and.... Nope! More errors. This time something about bad credentials. AWS is great, but it can be incredibly picky about permissions. After some more fiddling and prodding though, I did manage to get password reset emails working.</p>
<p>I clicked the link in the email from my blog, and it brought me to the password reset page. I filled in a new password and hit submit. Navigating back to the login screen, I proceeded to enter in the new login and password. Upon hitting submit, I was greeted with a lovely error about it <strong>not being the right username/password</strong> ......WAT?!?</p>
<p>Something's not right, I thought. I'm going to run the service manually and take a peek at the output. What I saw was pretty disturbing (for me at least). Something along the lines of &quot;Your database is incompatible with this version of Ghost - You will have to create a new one&quot;. No problem, I though, I'll just switch back to the old version!</p>
<p>I checked out the previous version I was running, ran the scripts to set everything up and booted up the service manually. I loaded my home page, which displayed perfectly. I then tried to get to the login screen. This is when I really started to sweat... It wouldn't load! I would wait for a dozen seconds or so, and nginx (used for proxying) would 502 me! Looking in the console, I saw a message along the lines of &quot;Unhandled exception: session table doesn't exist&quot;. I had no idea what was up.</p>
<p>Things didn't look good for chrisdecairos.ca... I decided my only option was to copy my contents directory (contains the sqlite db file, images, and themes directory) and my configuration file somewhere safe so that I could wipe the slate clean on my ghost installation. I downloaded the official release zip of ghost 0.4.2 and replaced my installation with its contents. I double checked that all the dependencies were in plave and that all assets were built. I copied over my config file, and started up the service.</p>
<p>It worked. I was able to log into a new account and regain access to the admin tools. I re-instated all the themes settings to get the look and feel of the blog back. With everything back up and running, the only thing left for me was to migrate all my posts and tags into the new db file. With a bit of research, I found what I needed:</p>
<p><code>sqlite3 ghost.db .dump &gt; ghost.sql</code></p>
<p>Which dumps the sql to create your DB into a file. I opened up that file and deleted all the statements that weren't related to posts, tags and posts_tags. I also removed the create sytax for those tables. I should mention that I compared the schemas between the old db file and the new, and they were identical. This meant that once I ran the script, I should be back in business. Anyways, I scp'ed the script to my server, logged in and ran:</p>
<p><code>sqlite3 content/data/ghost.db &lt; ~/ghost.sql</code></p>
<p>and crossed my fingers.....</p>
<p>When I reloaded my blog, <strong>everything was back to normal!</strong> I had succeeded! I had also lost most of my evening -.-</p>
<p>The takeaways from this are two:</p>
<ol>
<li>Back up your database, you dummy!</li>
<li>Git checkout is a horrible way to update blog software.</li>
</ol>
<p>But hey, at least I know how to recover my blog in situations like this.</p>
<!--kg-card-end: markdown-->
        </section>

        <footer class="post-footer">

                <section class="author">
                    <h4>Chris DeCairos</h4>
                    <p></p>
                </section>

            <section class="share">
                <h4>Share this</h4>
                <a class="icon-twitter" href="http://twitter.com/share?text=Oh noes.&url=https://chrisdecairos.ca/oh-noes/">
                    <span class="hidden">Twitter</span>
                </a>
                <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://chrisdecairos.ca/oh-noes/">
                    <span class="hidden">Facebook</span>
                </a>
                <a class="icon-google-plus" href="https://plus.google.com/share?url=https://chrisdecairos.ca/oh-noes/">
                    <span class="hidden">Google+</span>
                </a>
            </section>

        </footer>


    </article>

</main>


    <footer class="site-footer">
        <a class="subscribe icon-feed" href="https://chrisdecairos.ca/rss/"><span class="tooltip">Subscribe!</span></a>
        <div class="inner">
             <section class="copyright">All content copyright <a href="/">Chris DeCairos</a> &copy; 2024 &bull; All rights reserved.</section>
        </div>
    </footer>

    

    <script type='text/javascript' src="/assets/highlighter/prettify.js?v=3a098a1af2"></script>
    <script type='text/javascript' src="/assets/js/shell.js?v=3a098a1af2"></script>
</body>
</html>
