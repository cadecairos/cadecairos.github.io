<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

    <title>Buggin&#x27; Out</title>

    <meta name="HandheldFriendly" content="True" />
    <meta name="MobileOptimized" content="320" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" type="text/css" href="/assets/highlighter/prettify.css?v=3a098a1af2" />
    <link rel="stylesheet" type="text/css" href="/assets/css/screen.css?v=3a098a1af2" />

    <script type='text/javascript' src="/assets/js/jquery-3.1.1.min.js?v=3a098a1af2"></script>
    <link rel="canonical" href="https://chrisdecairos.ca/buggin-out/">
    <meta name="referrer" content="no-referrer-when-downgrade">
    
    <meta property="og:site_name" content="Chris DeCairos">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Buggin&#x27; Out">
    <meta property="og:description" content="As I detailed in my last post [https://chrisdecairos.ca/osd700-release-2.html], I&#x27;ve been
hacking on Firefox bug 517363
[https://bugzilla.mozilla.org/show_bug.cgi?id&#x3D;517363]. This bug aims to fix
&lt;video&gt; poster frame image stretching that occurs if you have a video that&#x27;s a
different aspect ratio as&lt;/video&gt;">
    <meta property="og:url" content="https://chrisdecairos.ca/buggin-out/">
    <meta property="article:published_time" content="2012-02-15T23:51:56.000Z">
    <meta property="article:modified_time" content="2018-08-22T02:24:40.000Z">
    <meta property="article:tag" content="Firefox">
    <meta property="article:tag" content="media">
    <meta property="article:tag" content="Mozilla">
    <meta property="article:tag" content="open-source">
    <meta property="article:tag" content="Seneca">
    <meta property="article:tag" content="video">
    
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Buggin&#x27; Out">
    <meta name="twitter:description" content="As I detailed in my last post [https://chrisdecairos.ca/osd700-release-2.html], I&#x27;ve been
hacking on Firefox bug 517363
[https://bugzilla.mozilla.org/show_bug.cgi?id&#x3D;517363]. This bug aims to fix
&lt;video&gt; poster frame image stretching that occurs if you have a video that&#x27;s a
different aspect ratio as&lt;/video&gt;">
    <meta name="twitter:url" content="https://chrisdecairos.ca/buggin-out/">
    <meta name="twitter:label1" content="Written by">
    <meta name="twitter:data1" content="Chris DeCairos">
    <meta name="twitter:label2" content="Filed under">
    <meta name="twitter:data2" content="Firefox, media, Mozilla, open-source, Seneca, video">
    <meta name="twitter:site" content="@ChrisDeCairos">
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "Chris DeCairos",
        "url": "https://chrisdecairos.ca/",
        "logo": {
            "@type": "ImageObject",
            "url": "https://chrisdecairos.ca/content/images/2020/12/profile--Small-.jpg"
        }
    },
    "author": {
        "@type": "Person",
        "name": "Chris DeCairos",
        "image": {
            "@type": "ImageObject",
            "url": "//www.gravatar.com/avatar/5410ec660422c8ea12d4a28ef794a23a?s=250&d=mm&r=x",
            "width": 250,
            "height": 250
        },
        "url": "https://chrisdecairos.ca/author/chris/",
        "sameAs": []
    },
    "headline": "Buggin&#x27; Out",
    "url": "https://chrisdecairos.ca/buggin-out/",
    "datePublished": "2012-02-15T23:51:56.000Z",
    "dateModified": "2018-08-22T02:24:40.000Z",
    "keywords": "Firefox, media, Mozilla, open-source, Seneca, video",
    "description": "\n\nAs I detailed in my last post [https://chrisdecairos.ca/osd700-release-2.html], I&#x27;ve been\nhacking on Firefox bug 517363\n[https://bugzilla.mozilla.org/show_bug.cgi?id&#x3D;517363]. This bug aims to fix\n&lt;video&gt; poster frame image stretching that occurs if you have a video that&#x27;s a\ndifferent aspect ratio as the poster itself.  After a lot of trial and error, I\ncame up with this patch\n[https://bugzilla.mozilla.org/attachment.cgi?id&#x3D;595655&amp;action&#x3D;diff], which\nseemed to do the job. cpearce took a look at",
    "mainEntityOfPage": "https://chrisdecairos.ca/buggin-out/"
}
    </script>

    <meta name="generator" content="Ghost 5.62">
    <link rel="alternate" type="application/rss+xml" title="Chris DeCairos" href="https://chrisdecairos.ca/rss/">
    
    <script defer src="https://cdn.jsdelivr.net/ghost/sodo-search@~1.1/umd/sodo-search.min.js" data-key="6155d3cf5dbae2dc7c7242039b" data-styles="https://cdn.jsdelivr.net/ghost/sodo-search@~1.1/umd/main.css" data-sodo-search="https://chrisdecairos.ca/" crossorigin="anonymous"></script>
    
    <link href="https://chrisdecairos.ca/webmentions/receive/" rel="webmention">
    <script defer src="/public/cards.min.js?v=3a098a1af2"></script><style>:root {--ghost-accent-color: #15171A;}</style>
    <link rel="stylesheet" type="text/css" href="/public/cards.min.css?v=3a098a1af2">
</head>
<body class="post-template tag-firefox tag-media tag-mozilla tag-open-source tag-seneca tag-video">

    

<main class="content" role="main">

    <article class="post tag-firefox tag-media tag-mozilla tag-open-source tag-seneca tag-video no-image">

        <header class="post-header">
            <a id="blog-logo" href="https://chrisdecairos.ca">
                    <img src="https://chrisdecairos.ca/content/images/2020/12/profile--Small-.jpg" alt="Blog Logo" />
            </a>
        </header>


        <span class="post-meta"><time datetime="2012-02-15">15 Feb 2012</time> on <a href="/tag/firefox/">Firefox</a> | <a href="/tag/media/">media</a> | <a href="/tag/mozilla/">Mozilla</a> | <a href="/tag/open-source/">open-source</a> | <a href="/tag/seneca/">Seneca</a> | <a href="/tag/video/">video</a></span>

        <h1 class="post-title">Buggin&#x27; Out</h1>

        <section class="post-content">
            <!--kg-card-begin: markdown--><p><img src="https://media.giphy.com/media/o0vwzuFwCGAFO/giphy.gif" alt loading="lazy"></p>
<p>As I detailed in <a href="https://chrisdecairos.ca/osd700-release-2.html">my last post</a>, I've been hacking on Firefox <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=517363&ref=chrisdecairos.ca">bug 517363</a>. This bug aims to fix &lt;video&gt; poster frame image stretching that occurs if you have a video that's a different aspect ratio as the poster itself.  After a lot of trial and error, I came up with <a href="https://bugzilla.mozilla.org/attachment.cgi?id=595655&action=diff&ref=chrisdecairos.ca">this patch</a>, which seemed to do the job. cpearce took a look at the patch, and pushed it up to try. This revealed that my patch was <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=517363&ref=chrisdecairos.ca#c10">breaking reftests</a> related to poster frames.</p>
<p>An investigation into this revealed that my code was not drawing the poster if a video element did not have a set size (Either through height/width or CSS). Roc pointed me to an object in the method called aMetrics, which contains the calculated height/width of the video's drawing area. This is what I needed. I reworked my solution to use aMetrics. Testing against this new code I noticed a completely different issue with poster frames.</p>
<p>Lets say you have a video that's 500x500, and a poster image that's 250x250. When Firefox loads, it will create the video at an initial size of 250x250.  I thought that this looked weird and mentioned it in the poster frame scaling bug.  Roc linked me to <a href="http://www.whatwg.org/specs/web-apps/current-work/?ref=chrisdecairos.ca#dom-video-videowidth">the spec for intrinsic video sizes</a> which states:</p>
<p>&quot;The intrinsic width of a video element's playback area is the intrinsic width of the video resource, if that is available; otherwise it is the intrinsic width of the poster frame, if that is available; otherwise it is 300 CSS pixels.</p>
<p>The intrinsic height of a video element's playback area is the intrinsic height of the video resource, if that is available; otherwise it is the intrinsic height of the poster frame, if that is available; otherwise it is 150 CSS pixels.&quot;</p>
<p>Using the spec as a guide it's clear that things aren't working correctly when calculating intrinsic video size.  I filed <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=726904&ref=chrisdecairos.ca">bug 726904</a> on this issue, assigned it to myself and began working on a fix. Luckily all the code I need exists already in nsVideoFrame::GetVideoIntrinsicSize, it just needs to be rearranged to do things in a proper order. Once I had a fix, I started playing around with some different use cases.  I noticed a couple things while doing so. If your video sets the preload attribute to &quot;none&quot;, there will not be any information about the video when it gets it's intrinsic size, and will go with the poster frame. This makes perfect sense. If there is no preload attribute or it's set to &quot;auto&quot; then the video will report the size of the video, which seems to load its metadata in time. After getting some feedback on <a href="https://bugzilla.mozilla.org/attachment.cgi?id=597238&action=diff&ref=chrisdecairos.ca">my first patch</a>, I've juggled things around a little more and now I'm preparing a new patch for some feedback.</p>
<p>I'm thinking about applying for<a href="http://www.mozilla.org/hacking/committer/?ref=chrisdecairos.ca"> Level one commit access</a> so that I can run tests on my code, as it's hard to tell if my fixes are breaking other tests. This is especially true when it comes to the poster frame bugs, because they change the current behaviour of the video element that other tests might rely on. now I just need somebody to vouch for me.</p>
<!--kg-card-end: markdown-->
        </section>

        <footer class="post-footer">

                <section class="author">
                    <h4>Chris DeCairos</h4>
                    <p></p>
                </section>

            <section class="share">
                <h4>Share this</h4>
                <a class="icon-twitter" href="http://twitter.com/share?text=Buggin&#x27; Out&url=https://chrisdecairos.ca/buggin-out/">
                    <span class="hidden">Twitter</span>
                </a>
                <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://chrisdecairos.ca/buggin-out/">
                    <span class="hidden">Facebook</span>
                </a>
                <a class="icon-google-plus" href="https://plus.google.com/share?url=https://chrisdecairos.ca/buggin-out/">
                    <span class="hidden">Google+</span>
                </a>
            </section>

        </footer>


    </article>

</main>


    <footer class="site-footer">
        <a class="subscribe icon-feed" href="https://chrisdecairos.ca/rss/"><span class="tooltip">Subscribe!</span></a>
        <div class="inner">
             <section class="copyright">All content copyright <a href="/">Chris DeCairos</a> &copy; 2024 &bull; All rights reserved.</section>
        </div>
    </footer>

    

    <script type='text/javascript' src="/assets/highlighter/prettify.js?v=3a098a1af2"></script>
    <script type='text/javascript' src="/assets/js/shell.js?v=3a098a1af2"></script>
</body>
</html>
